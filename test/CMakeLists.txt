file(GLOB TEST_FILES *.png *.wxmx)

if(WIN32)
    install(FILES ${TEST_FILES} DESTINATION wxMaxima/data)
else()
    install(FILES ${TEST_FILES} DESTINATION share/wxMaxima)
endif()
file(COPY ${TEST_FILES} DESTINATION ${CMAKE_BINARY_DIR})

find_program(XVFB xvfb-run)
if(XVFB)
    add_test(NAME wxmaxima_batch_textcell WORKING_DIRECTORY ${CMAKE_BINARY_DIR} COMMAND xvfb-run --auto-servernum ./wxmaxima-local --batch textcells.wxmx)
    add_test(NAME wxmaxima_batch_foreign_characters WORKING_DIRECTORY ${CMAKE_BINARY_DIR} COMMAND xvfb-run --auto-servernum ./wxmaxima-local --batch foreign-characters.wxmx)
    add_test(NAME wxmaxima_version_string WORKING_DIRECTORY ${CMAKE_BINARY_DIR} COMMAND xvfb-run --auto-servernum ./wxmaxima-local --version)
    set_tests_properties(wxmaxima_version_string PROPERTIES  PASS_REGULAR_EXPRESSION "wxMaxima ${VERSION}.*")
    add_test(NAME wxmaxima_version_returncode WORKING_DIRECTORY ${CMAKE_BINARY_DIR} COMMAND xvfb-run --auto-servernum ./wxmaxima-local --version)
    add_test(NAME wxmaxima_help WORKING_DIRECTORY ${CMAKE_BINARY_DIR}  COMMAND xvfb-run --auto-servernum ./wxmaxima-local --help)
    # does currently not return 0; should work without xvfb-run
    # add_test(NAME run_wxmaxima_batch COMMAND xvfb-run ./wxmaxima-local --batch test/testbench_automatic.wxmx)
else()
    message(STATUS "xvfb not found => Not enabling the tests.")
endif()
